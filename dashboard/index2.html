<!DOCTYPE html>
<html>
    <head>
        <title>autoTuple Monitoring</title>
        <link rel="icon" type="image/png" sizes="96x96" href="images/favicon.png">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <link rel="stylesheet" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    </head>

    <body>

        <script>

            function getProgress(sample) {
                var stat = sample["status"];
                var done = sample["done"];
                var tot = sample["total"];

                if (stat == "new") return 0.0;
                else if (stat == "submitting") return 5.0;
                else if (stat == "crab") return 5.0 + 40.0*(done/tot);
                else if (stat == "mergelists") return 45.0;
                else if (stat == "postprocessing") return 55.0 + 35.0*(done/tot);
                else if (stat == "copying") return 95.0;
                else if (stat == "done") return 100.0;
                else return -1.0;

            }

            function parseJson(data) {
                for(var i = 0; i < data["samples"].length; i++) {
                    console.log(data["samples"][i]);
                    var container = $("#section_1");
                    container.append("<br>");
                    container.append("<a href='#/' class='thick' onClick=\"$('#details_"+i+"').slideToggle(150)\">"+data["samples"][i]["name"]+"</a>");

                    container.append("<div class='pbar' id='pbar_"+i+"'><span id='pbartext_"+i+"' class='pbartext'></span></div>");

                    // FIXME, display:none
                    // container.append("<div id='details_"+i+"' style='display:none;'></div>");
                    container.append("<div id='details_"+i+"' ></div>");

                    $( "#pbar_"+i ).progressbar({max: 100});

                    var pct = Math.round(getProgress(data["samples"][i]));

                    var color = 'hsl(' + pct*1.2 + ', 70%, 50%)';
                    $("#pbar_"+i).progressbar("option","value",pct);
                    $("#pbar_"+i).find(".ui-progressbar-value").css({"background": color});
                    $("#pbartext_"+i).text(data["samples"][i]["status"] + " [" + pct + "%]");

                    $("#details_"+i).append(JSON.stringify(data["samples"][i]));


                }
            }

            var detailsVisible = true;
            function expandAll() {
                // do it this way because one guy may be reversed
                if(detailsVisible) {
                    $("#toggle_all").text("show details")
                    $("[id^=details_]").slideUp(150);
                } else {
                    $("#toggle_all").text("hide details")
                    $("[id^=details_]").slideDown(150);
                }
                detailsVisible = !detailsVisible;
            }

            $(function () {
                // $.getJSON("http://uaf-6.t2.ucsd.edu/~namin/dump/test.json", function(data) { parseJson(data); });
                // WOW CAN PUT EXTERNAL URLS HERE MAN!
                $.getJSON("test.json", function(data) { parseJson(data); });

            })


        </script>

        <div id="topBar">
            <img class="mainlogo" src="crab.png" />
            <span class="thin">auto</span>Tupler
            <span class="thin">
                &emsp;
                <a href="#" onClick="$('#section_1').slideToggle(150)">section_1</a>&ensp;|&ensp;
                <a href="#" id="toggle_all" onClick="expandAll()">hide details</a>&ensp;|&ensp;
                <a href="#" onClick="$('#section_3').slideToggle(150)">section_3</a>
            </span>
        </div>
        <div id="colorstrip"></div>

        <div id="container">

            <div id="section_1" class="section"                      > section_1 </div>
            <div id="section_2" class="section" style='display:none;'> section_2 </div>
            <div id="section_3" class="section" style='display:none;'> section_3 </div>

        </div>

    </body>
</html>
